!function(e,t,a,n){"use strict";var l=t.module("ngDragDrop",[]).service("ngDragDropService",["$timeout","$parse",function(i,r){this.draggableScope=null,this.droppableScope=null,this.callEventCallback=function(e,t,n,l){function i(t){var n=-1!==t.indexOf("(")?t.indexOf("("):t.length,l=-1!==t.lastIndexOf(")")?t.lastIndexOf(")"):t.length,i=t.substring(n+1,l),o=t.match(/^[^.]+.\s*/)[0].slice(0,-1);return o=e[o]&&"function"==typeof e[o].constructor?o:null,{callback:t.substring(o&&o.length+1||0,n),args:a.map(i&&i.split(",")||[],function(t){return[r(t)(e)]}),constructor:o}}if(t){var o=i(t),s=o.callback,d=o.constructor,p=[n,l].concat(o.args);return(e[s]||e[d][s]).apply(e,p)}},this.invokeDrop=function(e,a,r,o){var s,d,p="",c="",u={},g={},b=null,f={},h={},v=null,y=this.droppableScope,m=this.draggableScope;p=e.ngattr("ng-model"),c=a.ngattr("ng-model"),s=m.$eval(p),d=y.$eval(c),v=a.find("[jqyoui-draggable]:last,[data-jqyoui-draggable]:last"),g=y.$eval(a.attr("jqyoui-droppable")||a.attr("data-jqyoui-droppable"))||[],u=m.$eval(e.attr("jqyoui-draggable")||e.attr("data-jqyoui-draggable"))||[],u.index=this.fixIndex(m,u,s),g.index=this.fixIndex(y,g,d),b=t.isArray(s)?u.index:null,f=t.isArray(s)?s[b]:s,u.deepCopy&&(f=t.copy(f)),h=t.isArray(d)&&g&&g.index!==n?d[g.index]:t.isArray(d)?{}:d,g.deepCopy&&(h=t.copy(h)),u.animate===!0?(this.move(e,v.length>0?v:a,null,"fast",g,null),this.move(v.length>0&&!g.multiple?v:[],e.parent("[jqyoui-droppable],[data-jqyoui-droppable]"),l.startXY,"fast",g,t.bind(this,function(){i(t.bind(this,function(){e.css({position:"relative",left:"",top:""}),v.css({position:"relative",left:"",top:"",display:"none"===v.css("display")?"":v.css("display")}),this.mutateDraggable(m,g,u,p,c,h,e),this.mutateDroppable(y,g,u,c,f,b),this.callEventCallback(y,g.onDrop,r,o)}))}))):i(t.bind(this,function(){this.mutateDraggable(m,g,u,p,c,h,e),this.mutateDroppable(y,g,u,c,f,b),this.callEventCallback(y,g.onDrop,r,o)}))},this.move=function(t,a,l,i,r,o){if(0===t.length)return o&&e.setTimeout(function(){o()},300),!1;var s=t.css("z-index"),d=t[r.containment||"offset"](),p=a.css("display"),c=a.hasClass("ng-hide");null===l&&a.length>0&&((a.attr("jqyoui-draggable")||a.attr("data-jqyoui-draggable"))!==n&&a.ngattr("ng-model")!==n&&a.is(":visible")&&r&&r.multiple?(l=a[r.containment||"offset"](),r.stack===!1?l.left+=a.outerWidth(!0):l.top+=a.outerHeight(!0)):(c&&a.removeClass("ng-hide"),l=a.css({visibility:"hidden",display:"block"})[r.containment||"offset"](),a.css({visibility:"",display:p}))),t.css({position:"absolute","z-index":9999}).css(d).animate(l,i,function(){c&&a.addClass("ng-hide"),t.css("z-index",s),o&&o()})},this.mutateDroppable=function(e,a,n,l,i,o){var s=e.$eval(l);e.dndDragItem=i,t.isArray(s)?(a&&a.index>=0?s[a.index]=i:s.push(i),n&&n.placeholder===!0&&(s[s.length-1].jqyoui_pos=o)):(r(l+" = dndDragItem")(e),n&&n.placeholder===!0&&(s.jqyoui_pos=o))},this.mutateDraggable=function(e,a,l,i,o,s,d){var p=t.equals(s,{})||!s,c=e.$eval(i);e.dndDropItem=s,l&&l.placeholder?"keep"!=l.placeholder&&(t.isArray(c)&&l.index!==n?c[l.index]=s:r(i+" = dndDropItem")(e)):t.isArray(c)?p?l&&l.placeholder!==!0&&"keep"!==l.placeholder&&c.splice(l.index,1):c[l.index]=s:(r(i+" = dndDropItem")(e),e.$parent&&r(i+" = dndDropItem")(e.$parent)),d.css({"z-index":"",left:"",top:""})},this.fixIndex=function(e,a,l){if(a.applyFilter&&t.isArray(l)&&l.length>0){var i=e[a.applyFilter](),r=i[a.index],o=n;return l.forEach(function(e,a){t.equals(e,r)&&(o=a)}),o}return a.index}}]).directive("jqyouiDraggable",["ngDragDropService",function(e){return{require:"?jqyouiDroppable",restrict:"A",link:function(a,n,i){var r,o,s,d=function(d){d?(r=a.$eval(n.attr("jqyoui-draggable")||n.attr("data-jqyoui-draggable"))||{},o=a.$eval(i.jqyouiOptions)||{},n.draggable({disabled:!1}).draggable(o).draggable({start:function(n,i){e.draggableScope=a,s=t.element(o.helper?i.helper:this).css("z-index"),t.element(o.helper?i.helper:this).css("z-index",9999),l.startXY=t.element(this)[r.containment||"offset"](),e.callEventCallback(a,r.onStart,n,i)},stop:function(n,l){t.element(o.helper?l.helper:this).css("z-index",s),e.callEventCallback(a,r.onStop,n,l)},drag:function(t,n){e.callEventCallback(a,r.onDrag,t,n)}})):n.draggable({disabled:!0})};a.$watch(function(){return a.$eval(i.drag)},d),d(),n.on("$destroy",function(){n.draggable({disabled:!0}).draggable("destroy")})}}}]).directive("jqyouiDroppable",["ngDragDropService","$q",function(e,a){return{restrict:"A",priority:1,link:function(n,l,i){var r,o=function(o){o?(r=n.$eval(t.element(l).attr("jqyoui-droppable")||t.element(l).attr("data-jqyoui-droppable"))||{},l.droppable({disabled:!1}).droppable(n.$eval(i.jqyouiOptions)||{}).droppable({over:function(t,a){e.callEventCallback(n,r.onOver,t,a)},out:function(t,a){e.callEventCallback(n,r.onOut,t,a)},drop:function(l,o){var s=null;s=r.beforeDrop?e.callEventCallback(n,r.beforeDrop,l,o):function(){var e=a.defer();return e.resolve(),e.promise}(),s.then(t.bind(this,function(){t.element(o.draggable).ngattr("ng-model")&&i.ngModel?(e.droppableScope=n,e.invokeDrop(t.element(o.draggable),t.element(this),l,o)):e.callEventCallback(n,r.onDrop,l,o)}),function(){o.draggable.css({left:"",top:""})})}})):l.droppable({disabled:!0})};n.$watch(function(){return n.$eval(i.drop)},o),o(),l.on("$destroy",function(){l.droppable({disabled:!0}).droppable("destroy")})}}}]);t.element.prototype.ngattr=function(e){var a=t.element(this).get(0);return a.getAttribute(e)||a.getAttribute("data-"+e)}}(window,window.angular,window.jQuery);