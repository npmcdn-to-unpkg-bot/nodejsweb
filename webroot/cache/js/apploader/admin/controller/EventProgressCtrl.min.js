define(["app"],function(app){app.controller("EventProgressCtrl",["$scope","$http","$location","$interval","$mdDialog",function($scope,$http,$location,$interval,$mdDialog){var amt=100,maxWait=2e3,maxRetryCount=25;$scope.progressValue=-1,$scope.countTo=amt,$scope.countFrom=0,$scope.message="",$scope.maxRetryCount=maxRetryCount,$scope.retryCount=0;var stop,progressFunc=function(data){if($scope.progressValue<$scope.countTo&&$scope.retryCount<$scope.maxRetryCount&&(-1!=$scope.progressValue||2!=$scope.retryCount)){if(0!=data.length){var count=eval(data[0].count),total=eval(data[0].total),progress=Math.floor(count/total*amt);$scope.progressValue=progress}$scope.retryCount++,$scope.retryCount>12?$scope.message="Umm, something seems strange. But just to let you know, we're still here with you.":$scope.retryCount>3&&($scope.message="We're still loading, do be patient.")}else $scope.stopLoad()};$scope.load=function(){angular.isDefined(stop)||(stop=$interval(function(){getHTTP($http,calLoadURL,progressFunc)},maxWait,maxRetryCount+1))},$scope.stopLoad=function(){angular.isDefined(stop)&&($interval.cancel(stop),stop=void 0),-1==$scope.progressValue?$location.url("eventempty"):$location.url("eventsubmit")},$scope.$on("$destroy",function(){$scope.stopLoad()}),$scope.load()}])});