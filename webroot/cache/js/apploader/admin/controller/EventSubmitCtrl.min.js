define(["app","moment"],function(e,t){e.directive("myPostRepeatDirective",function(){return function(e){e.$last&&angular.element(document.querySelector("#loader")).css("display","none")}}),e.controller("EventSubmitCtrl",["$scope","$http","$location","$mdDialog",function(e,t,n,r){function o(){return e.events}function a(e){return _.groupBy(e,function(e){var t=new Date(e.start),n=new Date(t.getUTCFullYear(),t.getUTCMonth(),1,0,0,0,0);return n.getTime()})}new Date,new Date;e.minDate=new Date,e.maxDate=new Date,e.word=/^([A-Z|a-z|0-9]+\s{0,1}[A-Z|a-z|0-9]*)*$/,e.events=[],e.predicate="start",e.virtualDel="",e.userInfoAllow=function(e){for(var t=["","E","C","A"],n=e.toString(3),r=0,o="",a=n.length-1;a>=0;a--){var c=n.charAt(a);1==c?o+=t[r]+",":2==c&&(o+=t[r]+"[Opt],"),r++}return""==o?"":o.substring(0,o.length-1)},e.filterSearch=function(){if(void 0!=e.endD&&void 0!=e.startD)e.endD.setMinutes(0,0,0),e.endD.setHours(24),t({method:"GET",url:calSetupConfURL+"/"+e.startD.getTime()+"/"+e.endD.getTime(),headers:{"Content-Type":"application/json"}}).success(function(t){e.events=t,e.groupEvents=a(t)}).error(function(){e.events=[],e.groupEvents=[]});else{var n=function(t){e.events=t,e.groupEvents=a(t)};getHTTP(t,calSetupConfURL+"/0/0",n)}},e.filterSearch(),e.dateOptions={formatYear:"yy",startingDay:1},e.showAlert=function(e,t){r.show(r.alert().title("Opps, Error Encountered").content(t).ariaLabel("Error").ok("Ok").targetEvent(e))},e.showOK=function(){n.url("eventempty")},e.rejectForm=function(n){var o=r.confirm().title("Reject All Events").content("Are you sure to remove all your calendar setup?").ariaLabel("Reject Form").ok("Reject").cancel("No").targetEvent(n);r.show(o).then(function(){var r=function(){e.flag=!1,e.showOK(n)},o=function(){e.flag=!1,e.showAlert(n,"System encountered Exception. Please try again.")},a=function(){e.flag=!1,e.showAlert(n,"System encountered Exception. Please try again.")};funcHTTP(t,"DELETE",calSetupConfURL,{},r,o,a)},function(){})},e.resetForm=function(t){e.startD=void 0,e.endD=void 0;var n=r.confirm().title("Reset Form").content("Are you sure to reset all your changes?").ariaLabel("Reset Form").ok("Reset").cancel("No").targetEvent(t);r.show(n).then(function(){e.filterSearch()},function(){})},e.processForm=function(n){if(!e.flag){if(0==e.setup.$valid)return e.flag=!1,e.showAlert(n,"Please check for errors."),void 0;e.flag=!0,e.formData=o();var r=function(){e.flag=!1,e.showOK(n)},a=function(){e.flag=!1,e.showAlert(n,"Please check for errors.")},c=function(){e.flag=!1};funcHTTP(t,"POST",calSetupConfURL,e.formData,r,a,c)}}}])});