define(["app","modalInstance","lodash"],function(app){function createProfileJSON(e){return{firstName:e.fstName,midName:e.midName,lastName:e.lstName,gender:e.gender,country:e.cntry,state:e.state.id,pstCd:e.pstCd,addr:e.addr,email:e.email,ctcNo:e.ctcNo}}function checkNotValidity(e){var t=!1;return void 0==e.ctcNo&&void 0!=e.profile.ctcNo.$viewValue?!0:void 0==e.pstCd&&void 0!=e.profile.pstCd.$viewValue?!0:t}function retrieveEditProfile($scope,$http){$http.get(userProfileURL).success(function(data){$scope.fstName=data.firstName,$scope.midName=data.midName,$scope.lstName=data.lastName,$scope.gender=data.gender,$scope.ctcNo=data.ctcNo,$scope.cntry=data.country,$scope.pstCd=data.pstCd,$scope.addr=data.addr,$scope.email=data.email;var jsonState=eval("({'id':'"+data.state+"'})");$scope.state=$scope.states[_.findIndex($scope.states,jsonState)]})}function init(e){e.postalCd=/^[1-9][0-9]{0,4}$/,e.number=/^\+?[0-9]{0,13}$/,e.cntry="MY",e.gender="O",e.flag=!1,e.formData={}}function insert(e,t){var a=function(){t.open("new")},o=function(e){t.errors=e.errors,t.flag=!1},r=function(e){t.errors=e.errors,t.flag=!1,location.href="#"};funcHTTP(e,"PUT",userProfileURL,t.formData,a,o,r)}function update(e,t){var a=function(){t.open("edit"),t.flag=!1},o=function(e){t.errors=e.errors,t.flag=!1},r=function(e){t.errors=e.errors,t.flag=!1,location.href="#/notify/profile/1"};funcHTTP(e,"POST",userProfileURL,t.formData,a,o,r)}app.controller("ProfileCtrl",["$scope","$http","$modal","$routeParams",function(e,t,a,o){init(e),t.get("/cache/json/mlystate.json").success(function(t){e.states=t}),e.fstName=o.firstName,e.lstName=o.lastName,e.edit=1==o.edit?!0:!1,e.edit&&retrieveEditProfile(e,t),e.open=function(e){a.open({templateUrl:"popupdialog.html",controller:"ModalInstanceCtrlProfile",backdrop:"static",resolve:{status:function(){return e}}})},e.processForm=function(){checkNotValidity(e)||0==e.profile.$valid||e.flag||(e.flag=!0,e.formData=createProfileJSON(e),e.errors=void 0,e.edit?update(t,e):insert(t,e))},e.cancel=cancelBtn}])});