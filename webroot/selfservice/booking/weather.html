<!DOCTYPE HTML>
<head>
	<title>Calendar Me</title>
	<style type="text/css">
	      figure {
	        width: 368px;
	        height: 152px;
	      }
	
	      canvas {
	        display: block;
	        float: left;
	        margin-left: 8px;
	        margin-top: 8px;
	      }
	</style>
</head>
<body>
<div>
	<figure class="icons">
		<canvas id="weatherIcon" width="128" height="128"></canvas>
	</figure>
	<span id="weatherMessage">Locating weather...</span>
</div>
</body>
<script src="/cache/js/jquery/jquery.min.js"></script>
<script src="/cache/js/ext/weather/skycons.js"></script>
<script>
var skycons = new Skycons({"color": "#09F"});
skycons.add("weatherIcon", Skycons.UNKNOWN);
skycons.play();

$( document ).ready(function() {
	if("WebSocket" in window){
		var ws = new WebSocket("ws://localhost:9000/tools/weatherinfo");
		ws.onopen = function(){
			ws.send('{"state":"KL", "date":"12"}');
		}
		ws.onmessage = function( event ){
			var receivedJson = JSON.parse(event.data);
			var icon = Skycons.UNKNOWN;

			switch(receivedJson.icon){
				case "clear-day":
					icon = Skycons.CLEAR_DAY;
					break;
				case "clear-night":
					icon = Skycons.CLEAR_NIGHT;
					break; 
				case "rain":
					icon = Skycons.RAIN;
					break;
				case "snow":
					icon = Skycons.SNOW;
					break;
				case "sleet":
					icon = Skycons.SLEET;
					break;
				case "wind":
					icon = Skycons.WIND;
					break;
				case "fog":
					icon = Skycons.FOG;
					break;
				case "cloudy":
					icon = Skycons.CLOUDY;
					break;
				case "partly-cloudy-day":
					icon = Skycons.PARTLY_CLOUDY_DAY;
					break;
				case "partly-cloudy-night":
					icon = Skycons.PARTLY_CLOUDY_NIGHT;
					break;
				default:
					icon = Skycons.UNKNOWN;
					break;
			};
			if(icon == Skycons.UNKNOWN){
				skycons.remove("weatherIcon")
			}else{
				skycons.set("weatherIcon", icon);
				$("#weatherMessage").text(receivedJson.summary)
			}
			
		}
		ws.onclose = function(){
			alert("Connection closed");
		}
	}else{
		//socket not support. Oh well..
	}
});
</script>
</html>
